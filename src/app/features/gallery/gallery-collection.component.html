<section class="collection-section">
  <div class="container-xl py-5">

    <header class="mb-4 d-flex flex-column flex-md-row align-items-md-end justify-content-between gap-3">
      <div>
        <p class="text-uppercase text-muted small mb-1">Gallery collection</p>
        <h1 class="display-6 mb-2">All artworks</h1>
        <p class="text-muted mb-0">
          Explore the full Aurora collection with live searching, sorting and smart filters.
        </p>
      </div>

      <div class="text-md-end small text-muted mt-2 mt-md-0">
        <span *ngIf="!loading">
          Showing {{ shownCount }} of {{ totalCount }} artworks
        </span>
      </div>
    </header>

    <!-- Filters card -->
    <div class="card border-0 shadow-sm rounded-4 mb-4">
      <div class="card-body d-flex flex-column flex-lg-row align-items-lg-center gap-3">
        <!-- Search -->
        <div class="flex-grow-1 position-relative">
          <span class="position-absolute top-50 start-0 translate-middle-y ps-3 text-muted">
            <i class="bi bi-search"></i>
          </span>
          <input
            type="text"
            class="form-control ps-5 rounded-pill"
            placeholder="Search title or medium..."
            [ngModel]="searchTerm"
            (ngModelChange)="onSearchTermChange($event)"
          />
        </div>

        <!-- Sort select -->
        <div>
          <select
            class="form-select rounded-pill"
            [ngModel]="sortBy"
            (ngModelChange)="onSortChange($event)"
          >
            <option value="title">Title Aâ€“Z</option>
            <option value="year-asc">Year â†‘</option>
            <option value="year-desc">Year â†“</option>
          </select>
        </div>

        <!-- Sale filter -->
        <div class="btn-group rounded-pill overflow-hidden">
          <button
            type="button"
            class="btn btn-sm px-3"
            [class.btn-warning]="saleFilter === 'all'"
            [class.btn-light]="saleFilter !== 'all'"
            (click)="onSaleFilterChange('all')"
          >
            All
          </button>
          <button
            type="button"
            class="btn btn-sm px-3"
            [class.btn-warning]="saleFilter === 'for-sale'"
            [class.btn-light]="saleFilter !== 'for-sale'"
            (click)="onSaleFilterChange('for-sale')"
          >
            For sale
          </button>
          <button
            type="button"
            class="btn btn-sm px-3"
            [class.btn-warning]="saleFilter === 'display-only'"
            [class.btn-light]="saleFilter !== 'display-only'"
            (click)="onSaleFilterChange('display-only')"
          >
            Display only
          </button>
        </div>

        <button type="button" class="btn btn-link text-decoration-none" (click)="resetFilters()">
          Reset
        </button>
      </div>
    </div>

    <!-- States -->
    <div *ngIf="loading" class="card border-0 shadow-sm rounded-4 p-4 text-center">
      Loading artworksâ€¦
    </div>

    <div *ngIf="!loading && error" class="card border-0 shadow-sm rounded-4 p-4 text-center text-danger">
      {{ error }}
    </div>

    <!-- Empty state -->
    <div
      *ngIf="!loading && !error && filteredArtworks.length === 0"
      class="card border-0 shadow-sm rounded-4 p-5 text-center"
    >
      <div class="fs-1 mb-3">ðŸ™‚</div>
      <h3 class="h5 mb-2">No artworks match your filters</h3>
      <p class="text-muted mb-3">
        Try removing a filter or searching for a different medium or year.
      </p>
      <button type="button" class="btn btn-warning rounded-pill px-4" (click)="resetFilters()">
        Clear filters
      </button>
    </div>

    <!-- Grid -->
    <div *ngIf="!loading && !error && filteredArtworks.length > 0" class="row g-4">
      <div class="col-sm-6 col-lg-4" *ngFor="let artwork of filteredArtworks">
        <article class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden">
          <div class="ratio ratio-4x3 bg-light">
            <img
              class="w-100 h-100 object-fit-cover"
              [src]="artwork.imageUrl || 'https://images.pexels.com/photos/594221/pexels-photo-594221.jpeg?auto=compress&cs=tinysrgb&w=960'"
              [alt]="artwork.title"
            />
          </div>

          <div class="card-body">
            <h3 class="h5 mb-1">{{ artwork.title }}</h3>
            <p class="text-muted small mb-2">
              <ng-container *ngIf="artwork.year">{{ artwork.year }}</ng-container>
              <ng-container *ngIf="artwork.year && artwork.medium"> Â· </ng-container>
              <ng-container *ngIf="artwork.medium">{{ artwork.medium }}</ng-container>
            </p>

            <p class="fw-semibold mb-2" *ngIf="artwork.price; else displayOnlyLabel">
              {{ artwork.price | currency : 'USD' : 'symbol' : '1.0-0' }}
            </p>
            <ng-template #displayOnlyLabel>
              <span class="badge rounded-pill text-bg-light">Display only</span>
            </ng-template>

            <a
              class="btn btn-sm btn-outline-secondary rounded-pill mt-1"
              [routerLink]="['/collection', artwork.id]"
            >
              View details
            </a>
          </div>
        </article>
      </div>
    </div>
  </div>
</section>
